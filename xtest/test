#!/usr/bin/python3
import os, sys
import re
import subprocess

TEST_DIR = "xtest/tests/"

RE_TEST = re.compile(".+\.lang$")
RE_CORRECT = re.compile(".+\.lang\.correct")

dirs = os.listdir(TEST_DIR)
tests = []
for file in dirs:
    if RE_TEST.match(file):
        tests.append(file)

for test in tests:
    testpath = TEST_DIR + test
    output_file = open(testpath + ".correct", mode='r')
    expected_output = output_file.read()
    output_file.close()

    process = subprocess.Popen(["./lang", testpath], stdout=subprocess.PIPE)
    process.wait()

    test_output = process.stdout.read()

    if test_output == expected_output:
        print("Passed!")
    else:
        print("Failed!")
        print("Got:")
        print(test_output)
        print("Expected:")
        print(expected_output)
