#!/usr/bin/python3
import os, sys
import re
import subprocess

TEST_DIR = "xtest/tests/"

RE_TEST = re.compile(".+\.lang$")
RE_CORRECT = re.compile(".+\.lang\.correct")

dirs = os.listdir(TEST_DIR)
tests = []
for file in dirs:
    if RE_TEST.match(file):
        tests.append(file)

for test in tests:
    testpath = TEST_DIR + test
    output_file = open(testpath + ".correct", mode='r')
    expected_output = output_file.read()
    output_file.close()
    
    subprocess.call(["./lang", testpath, "out.txt"])

    output_file = open("out.txt", mode='r')
    test_output = output_file.read()
    output_file.close()

    if test_output == expected_output:
        print("Passed!")
    else:
        print("Failed!")
        print("Got:")
        print(test_output)
        print("Expected:")
        print(expected_output)
